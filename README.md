# MapReduce

Лабораторная работа в рамках курса учебной практики. ФПМИ БГУ, 2020.

Репозиторий содержит простейшую реализацию модели MapReduce для распределенных
вычислений. Для распределения вычислений пока используется создание процессов
средствами библиотеки Boost.

Работоспособность решения под Windows не гарантируется (оно создавалось для
Linux-систем).

# Текущая реализация Map и Reduce

Предоставленные реализации Map и Reduce рассчитывают параметры активности
пользователя на тех или иных сайтах по предоставленным логам посещаемости.

## Формат входного файла Map

Каждая строка входного файла должна иметь вид:

`site_address_string \t user_id \t time \n`

Первым словом должен идти адрес сайта (произвольная строка), далее после 
отступа (`\t`) - беззнаковое 64-битное число, идентификатор пользователя,
далее после еще одного отступа (`\t`) - беззнаковое 64-битное число, время,
которое пользователь провел на сайте.

Адреса сайтов, идентификаторы пользователей могут неоднократно повторяться
(пользователь может заходить на сайт много раз).

Строки файла (в том числе его последняя строка) должны оканчиваться стандартным
переводом строки (`\n`).

## Формат выходного файла Map

Каждая строка будет иметь вид:

`user_id \t site_address_string \t time`

Первым словом идет беззнаковое 64-битное число, идентификатор пользователя,
далее после отступа (`\t`) адрес сайта, далее после еще одного отступа (`\t`)
беззнаковое 64-битное число, время, проведенное пользователем на сайте.

Адреса сайтов, идентификаторы пользователей могут неоднократно повторяться
(пользователь может заходить на сайт много раз).

Строки файла (в том числе его последняя строка) будут оканчиваться стандартным
переводом строки (`\n`).

## Формат входного файла Reduce

Полностью совпадает с выходным форматом Map, за исключением того, что все
строки в файле должны соответствовать одному и тому же идентификатору
пользователя.

Это замечание влечет за собой следующее: при запуске операции Reduce через
скрипт MapReduce, которому передается просто выходной файл Map, этот файл
будет автоматически отсортирован и разделен на более мелкие, соответствующие
одному и тому же идентификатору пользователя.

## Формат выходного файла Reduce

Состоит из блоков вида:
```
User #user_id \n
site_address_string \t average_time \t min_time \t max_time \n
...
site_address_string \t average_time \t min_time \t max_time \n
```

Каждый идентификатор пользователя будет встречаться в файле не более одного
раза. Аналогично, каждый адрес сайта будет встречаться в любом блоке вывода
не более одного раза.

# Инструкции по сборке

При написании программы использовались некоторые механизмы библиотеки Boost
(в частности, `boost::process` и `boost::filesystem`).

Для сборки с использованием предоставленного CMake-скрипта рекомендуется 
использовать компилятор `gcc` версии 9.2 или выше, компилятор `clang` версии
9 или выше.

Убедитесь также, что у вас установлены компоненты библиотеки Boost. Установить
их можно, например, с использованием вашего пакетного менеджера:

`sudo apt install libboost-dev libboost-filesystem-dev`

# Инструкции по запуску

Скомпилируйте файлы `map.cpp` (далее будем называть полученный бинарный файл
скриптом Map), `reduce.cpp` (аналогично, полученный бинарный файл будем
называть скриптом Reduce) и `mapreduce.cpp` (сам скрипт MapReduce, будем
предполагать, что название бинарного файла - `mapreduce`).

Для запуска операции Map используйте команду:

`./mapreduce map <map_script> <src_file> <dst_file>`

Для запуска операции Reduce используйте команду:

`./mapreduce reduce <reduce_script> <src_file> <dst_file>`

Возможна работа с произвольным скриптом Map или Reduce (он даже необязательно
должен быть бинарным файлом), если:
* Формат выходного файла Map и входного файла Reduce будет соответствовать 
описанному выше.
* Вызвать скрипт можно будет командой: `./script`
* Скрипт будет считывать данные из переданного ему первым аргументом файла
и записывать данные в переданный ему вторым аргументом файл.
